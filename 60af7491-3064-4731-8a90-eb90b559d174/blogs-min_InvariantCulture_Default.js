var Wdc=Wdc||{};Wdc.Cpub=Wdc.Cpub||{};Wdc.Cpub.Blogs=Wdc.Cpub.Blogs||{};Wdc.Cpub.Blogs=function(){"use strict";var s="",l=0,o=false,j="all",d="hidden",h=".blog-link",g="#blogs-select",i=".blog-name",m="#latest-blogs-body",p=".network-error",k=$("#blog-cntr").data(),q=$("#blogs-select option").data().all,f=[],a=[],n=[],e=[],c={},b={createBlogEntries:function(f){var e=[],h=["January","February","March","April","May","June","July","August","September","October","November","December"],g=function(a){$.each(a,function(b){var l=a[b].title,n=a[b].link,i=a[b].creator,j=a[b].pubDate,c=new Date(j),k=h[c.getMonth()],p=c.getDate(),o=c.getFullYear(),e=$("<li class='blog-entry'></li>"),d=$("<div class='blog-entry-info'></div>"),f=$("<div class='blog-list'><a target='_blank' href='"+n+"'><div class='title'>"+l+"</div></a></div>"),g=$("<div class='date'><span>"+k+" "+p+", "+o+" </span> <span>"+i+"</span></div>");$(m).append(e.append(d.append(f).append(g)))})},d=function(a,b){$.each(c[a],function(d){if(d>=b)return;e.push(c[a][d])})};if(f===j||typeof c[f]===undefined){for(var b=0;b<a.length;b++)switch(a.length){case 1:d(a[b],6);break;case 2:d(a[b],3);break;case 3:d(a[b],2)}e.sort(function(a,b){return new Date(b.pubDate)-new Date(a.pubDate)});g(e)}else g(c[f])},addChannelNameToDropDown:function(a){var b=$("<option value='"+a+"'>"+a+"</option>");$(g).append(b)},setupBlogEntries:function(f){if(o){$(p).removeClass(d);return}$.each(f,function(h){var g=f[h].getElementsByTagName("title")[0].textContent,i=f[h].getElementsByTagName("link")[1].textContent;e.push({name:g,link:i});a.push(g);var d=f[h].getElementsByTagName("item");c[g]=[];$.each(d,function(b){var a={};a.title=d[b].getElementsByTagName("title")[0].textContent;a.link=d[b].getElementsByTagName("link")[0].textContent;a.pubDate=d[b].getElementsByTagName("pubDate")[0].textContent;a.creator=d[b].getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","creator")[0].textContent;if(b>5)return;c[g].push(a)});b.addChannelNameToDropDown(g)});f.length===1&&$(h).attr("href",e[0].link).removeClass(d);b.createBlogEntries(j)},getXmlDocs:function(a){l++;$.ajax({type:"GET",url:a,success:function(b){var a=b.getElementsByTagName("channel")[0];n.push(a)},error:function(){o=true},complete:function(){l--;l===0&&b.setupBlogEntries(n)}})},buildBlogDropdownToggle:function(){$(g).removeClass(d);var a=$(i).text();$(g).on("change",function(){var c=this.value;$(m).html(s);b.createBlogEntries(c);$.each(e,function(b){if(e[b].name===c){$(h).attr("href",e[b].link).removeClass(d);$(i).html(q);return}else if(c===j){$(h).addClass(d);$(i).html(a);return}})})}};function r(){for(var a in k)k.hasOwnProperty(a)&&f.push(k[a]);$.each(f,function(a){b.getXmlDocs(f[a])});f.length>1&&b.buildBlogDropdownToggle()}function t(){r()}return {init:t}}();$(function(){Wdc.Cpub.Blogs.init()})