if(typeof Wdc==="undefined")Wdc={};if(typeof Wdc.Cpub==="undefined")Wdc.Cpub={};if(typeof Wdc.Cpub.Analyzer==="undefined")Wdc.Cpub.Analyzer={};(function(){var j={"Marketplace-version":"1.0"},d="",f="%",c=null,db=2147483648,Q=1500,o="",z=0,A=0,i=null,C=null,E=null,r="https://developer.microsoft.com/WBACompatCheckWebApi/",bb=r+"Validate/HIPValidate?locale=en-us",q=r+"AppCompat/",ab=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Y=["ar-sa","he-il"],B=$.inArray(document.location.pathname.split("/")[1].toLowerCase(),Y)!==-1,F=$(".incompatible-browser-error").text(),T=$(".empty-ipa-error").text(),K=$(".invalid-extension-error").text(),U=$(".hip-empty-error").text(),O=$(".hip-mismatch-error").text(),S=$(".analyzing-error").text(),n=$(".request-failed-error").text(),cb=$(".file-size-error").text(),N=$(".encrypted-ipa-error").text(),M=$(".swift-detected-error").text(),l=$(".invalid-ipa-submitted-error").text(),p=$(".supported").text(),D=$(".unsupported").text(),X=$(".not-supported").text(),s=$(".partial").text(),W=$(".supported-text").text(),Z=$(".partial-text").text(),R=$(".unsupported-text").text(),y=".input-name",x=".input-email",P=".input-org",m=".file-drop-text",v=".file-info-name",k=".file-info, .file-info-delete",u=".error-container",t=".file-upload-progress",e=".file-analysis-status",w=".stage-working",h="a.download-zip",H="a.download-dataset",g=".analysis-pie-chart, .analysis-chart-content",b="hidden",a={updateProgressBar:function(a){$(".file-bar").css("width",a)},hip:{data:{solution:null,token:null,type:HipObject.type,flowId:null},verifyHip:function(a,b){HipObject.clientValidation();if(HipObject.error!==0)return;else{$("#Solution").val(a);$("#Token").val(b);$("#Type").val(HipObject.type);return}},shuffle:function(){var g=Math.random(),h=g.toString(),a=h.split(d).reverse(),b=a.length-2,c,e;while(--b>0){c=Math.floor(Math.random()*(b+1));e=a[c];a[c]=a[b];a[b]=e}var f=Number(a.reverse().join(d));return f},createGuidId:function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}},displayInputErrorMessage:function(b,a){$(b+"-error").text(a)},removeErrorMessage:function(a){$(a+"-error").text(d)},displaySubmitErrorMessage:function(a){$(".upload-failed-error").text(a);$(u).removeClass(b)},displayErrorDetail:function(c){var a=$(".report-error");a.text(c);a.removeClass(b)},analysis:{createPieChart:function(b){var i=b.StatusSummary.Supported,f=b.StatusSummary.Partial,h=b.StatusSummary.Unsupported,c=f+i+h,g=Math.round(i*100/c),d=Math.round(f*100/c),l=Math.round(h*100/c);$(".analysis-chart-content span.pie-supported-num").text(g+d);var k=$("#pie");k[0].getContext("2d").canvas.height=100;var n={labels:[p,s,X],datasets:[{data:[g,d,l],backgroundColor:["#006600","#e68a00","#b32d00"],hoverBackgroundColor:["#107C10","#EBD599","#EBADA9"],hoverBorderWidth:[0,0,0]}]},e=false,a=$("<div class='analysis-chart-tooltip'></div>"),j=$("<div class='analysis-chart-legend'></div>");$(".analysis-pie-chart").append(a);$(".analysis-chart-content").append(j);var m=new Chart(k,{type:"pie",data:n,options:{tooltips:{enabled:false,custom:function(b){if(!b.afterBody||b.afterBody===""){a.hide();return}var d=b.afterBody[0];a.html(d);var c=500;a.css({display:"block",left:b.x+c+"px",top:b.y+"px"})},callbacks:{afterBody:function(b,a){if(b[0].index===0)return "<div class='tooltip-title'><span class='win-icon win-icon-Completed'></span>"+a.datasets[0].data[0]+"% "+a.labels[0].toLowerCase()+"</div><div class='tooltip-body'>"+W+"</div>";else if(b[0].index===1)return "<div class='tooltip-title'><span class='win-icon win-icon-Warning'></span>"+a.datasets[0].data[1]+"% "+a.labels[1].toLowerCase()+"</div><div class='tooltip-body'>"+Z+"</div>";else return "<div class='tooltip-title'><span class='win-icon win-icon-ErrorBadge'></span>"+a.datasets[0].data[2]+"% "+a.labels[2].toLowerCase()+"</div><div class='tooltip-body'>"+R+"</div>"}}},animation:{easing:"easeInOutBounce",onComplete:function(){if(e)return;$(".chartjs-hidden-iframe")[0].style.height="";$(".chartjs-hidden-iframe").css("z-index","-1");j.html(m.generateLegend());e=true}},legend:{display:false}}})},getArrowClass:function(){return B?"arrow-left":"arrow-right"},downloadReport:function(){var a=r+"AppCompat/Report/"+E;$(h).on("click",function(c){c.preventDefault();function b(f,b,e){function d(c){var d=URL.createObjectURL(this.response||c),a=document.createElement("a");if("download"in a){a.href=d;a.download=e;document.body.appendChild(a);a.click();document.body.removeChild(a)}else{var b=new FileReader;b.addEventListener("load",function(c){var b=c.target;a.href=b.result;document.body.appendChild(a);a.click();document.body.removeChild(a)});b.readAsDataURL(this.response)}}var a=new XMLHttpRequest;a.onload=d;a.responseType="blob";a.open("GET",f);for(var c in b)a.setRequestHeader(c,b[c]);a.send()}b(a,{"Marketplace-version":"1.0","X-Caller":"FD"},"AnalysisReport.zip")})},createAnalysisReport:function(c){a.analysis.createPieChart(c);for(var d=[],t=0;t<c.Features.length;t++)d.push(c.Features[t].FeatureId);$.inArray(1000258,d)!==-1&&$(".ios-storekit").removeClass(b);$.inArray(1000317,d)!==-1&&$(".ios-mapkit").removeClass(b);$.inArray(1000295,d)!==-1&&$(".ios-watchkit").removeClass(b);$.inArray(2002004,d)!==-1&&$(".middleware-googlemaps").removeClass(b);$.inArray(2001602,d)!==-1&&$(".middleware-afnetworking").removeClass(b);$.inArray(2001615,d)!==-1&&$(".middleware-bolts").removeClass(b);$.inArray(2001633,d)!==-1&&$(".middleware-fb-ios-sdk").removeClass(b);$.inArray(2001649,d)!==-1&&$(".middleware-gtmlogger").removeClass(b);$.inArray(2001656,d)!==-1&&$(".middleware-jsonkit").removeClass(b);$.inArray(2001674,d)!==-1&&$(".middleware-openudid").removeClass(b);$.inArray(2001681,d)!==-1&&$(".middleware-reachability").removeClass(b);$.inArray(2001716,d)!==-1&&$(".middleware-sbjson").removeClass(b);if(c.ErrorDetailId>0)switch(c.ErrorDetailId){case 51:a.displayErrorDetail(N);$(g).hide();break;case 50:a.displayErrorDetail(M);$(g).hide();break;case 9:case 3:a.displayErrorDetail(l);$(g).hide()}if(c.InternalFailureOccured){a.displayErrorDetail(l);$(g).hide();$(h).hide();$(H).hide()}for(var f=0;f<c.ApiStatusInfo.length;f++){for(var e=c.ApiStatusInfo[f],r=$("<div class='framework-container'></div>"),v=$("<a class='framework-toggle' role='button' data-toggle='collapse' href='#"+e.FrameworkName+"' aria-expanded='false' aria-controls='"+e.FrameworkName+"'><span class='win-icon arrow-toggle "+a.analysis.getArrowClass()+"'></span><strong> "+e.FrameworkName+"</strong></a><span class='win-icon win-icon-Completed'></span> "+e.SupportedCount+"<span class='win-icon win-icon-Warning'></span> "+e.PartialCount+"<span class='win-icon win-icon-ErrorBadge'></span><span>"+e.UnsupportedCount+"</span>"),n=$("<div class='collapse framework-content' id='"+e.FrameworkName+"'></div>"),m=0;m<c.ApiStatusInfo[f].FrameworkElements.length;m++){var k=$("<div class='row spacer-12-top'><div class='col-xs-24 col-md-12'><div class='text-base'>"+c.ApiStatusInfo[f].FrameworkElements[m].Name+"</<div'></div></div>");if(c.ApiStatusInfo[f].FrameworkElements[m].Status==="Supported"){var o=$("<div class='col-xs-24 col-md-12'><span class='win-icon win-icon-Completed'></span> "+p+"</div>");o.appendTo(k);k.appendTo(n)}else if(c.ApiStatusInfo[f].FrameworkElements[m].Status==="Partial"){var o=$("<div class='col-xs-24 col-md-12'><span class='win-icon win-icon-Warning'></span> "+s+"</div>");o.appendTo(k);k.appendTo(n)}else{var o=$("<div class='col-xs-24 col-md-12'><span class='win-icon win-icon-ErrorBadge'></span> "+D+"</div>");o.appendTo(k);k.appendTo(n)}}v.appendTo(r);n.appendTo(r);r.appendTo($(".framework-report"))}if(c.Middleware.length>0)for(var i=0;i<c.Middleware.length;i++){var j=$("<div class='middleware-container'></div>");if(c.Middleware[i].Status==="Supported"){var q=$("<div class='row spacer-12-bottom'> <div class='col-xs-24 col-md-9'><div class='text-base'>"+c.Middleware[i].MiddlewareName+"</div></div> <div class='col-xs-24 col-md-8'><span class='win-icon win-icon-Completed'></span> "+p+"</div> </div>");q.appendTo(j);j.appendTo($(".middleware-report"))}else if(c.Middleware[i].Status==="Partial"){var q=$("<div class='row spacer-12-bottom'> <div class='col-xs-24 col-md-9'><div class='text-base'>"+c.Middleware[i].MiddlewareName+"</div></div> <div class='col-xs-24 col-md-8'><span class='win-icon win-icon-Warning'></span> "+s+"</div> </div>");q.appendTo(j);j.appendTo($(".middleware-report"))}else{var q=$("<div class='row spacer-12-bottom'> <div class='col-xs-24 col-md-9'><div class='text-base'>"+c.Middleware[i].MiddlewareName+"</div></div> <div class='col-xs-24 col-md-8'><span class='win-icon win-icon-ErrorBadge'></span> "+D+"</div> </div>");q.appendTo(j);j.appendTo($(".middleware-report"))}}$(".analysis-wrapper").show();if(c.ErrorDetailId===0){c.ApiStatusInfo.length>0&&$(".ios-frameworks").show();c.Middleware.length>0&&$(".middleware").show();$(".download-link").show()}else{$(".download-link").hide();$(h).hide()}$(".framework-toggle").on("click",function(){if($(this).children().first().hasClass(a.analysis.getArrowClass()))$(this).children().first().removeClass(a.analysis.getArrowClass()).addClass("arrow-down");else $(this).children().first().removeClass("arrow-down").addClass(a.analysis.getArrowClass())});var u=navigator.userAgent.toLowerCase(),x=u.indexOf("macintosh")!==-1,w=u.indexOf("safari")!==-1;if(x&&w){$(h).attr({"data-target":"#safariModal","data-toggle":"modal"});$(".modal-body").css("overflow-y","auto")}a.analysis.downloadReport()}},status:{updateReportUiStatus:function(b){switch(b.CurrentStateId){case 1:case 2:$(e).text($(".stage-uploading").text());a.updateProgressBar(b.Progress+f);break;case 3:case 4:case 5:case 6:case 7:$(e).text($(".stage-unpacking").text());a.updateProgressBar(b.Progress+f);A++;A>=20&&$(e).append($(w).text());break;case 8:case 9:case 10:$(e).text($(".stage-analyzing").text());a.updateProgressBar(b.Progress+f);z++;z>=20&&$(e).append($(w).text());break;case 16:case 17:case 18:$(e).text($(".stage-generating").text());a.updateProgressBar(b.Progress+f);break;case 22:case 24:case 25:a.updateProgressBar(b.Progress+f)}if(b.Status==="completed"){clearInterval(i);o=b.DeveloperAnalysisMessages;$(".file-analysis, .section-text").hide();$(".analysis-file-name").text(b.FileName);$(".analysis-targeted-for").text(b.TargetVersion);$(".analysis-file-size").text(parseFloat(Math.round(b.AppSizeInBytes/1024/1024*100)/100).toFixed(2));$(".analysis-min-version").text(b.MinOSVersion);$(".analysis-new-upload").on("click",function(){window.location.reload()});a.analysis.createAnalysisReport(b)}},updateReportUiStatusError:function(){clearInterval(i);$(".error-analyzing > .alert-error").text(S);$(".error-analyzing").removeClass(b)},checkStatusOfRequest:function(d){E=d.RequestId;$("form").addClass(b);var e=q+"Analyze/"+d.RequestId+"?locale=en-us";if(d!==""){$(".file-upload-cancel").on("click",function(a){a.preventDefault();clearInterval(i);window.location.reload()});var c=false;i=setInterval(function(){if(c)return;c=true;$.ajax({headers:j,type:"GET",url:e,success:function(b){a.status.updateReportUiStatus(b)},error:function(){a.status.updateReportUiStatusError()},complete:function(){c=false}})},Q)}}},uploadFileAndJsonToEndpoint:function(c,f,g,e,h){$(".file-analysis").show();var d={PackageBlobSasUrl:c,PackageFileName:C,PackageFileSizeInBytes:f.size,PackageSource:"web",CanKeepPackage:true,Email:e,CompanyName:h,ContactName:g,hipData:a.hip.data},b=JSON.stringify(d);$.ajax({headers:j,contentType:false,processData:false,type:"POST",url:q+"Analyze?locale=en-us",data:b,success:function(b){a.status.checkStatusOfRequest(b)},error:function(){a.displaySubmitErrorMessage(n)}})},storage:{generateRandomBlockId:function(){function a(){return ((1+Math.random())*65536|0).toString(16).substring(1)}return btoa(a()+a()+a())},commitSingleBlock:function(h,f,g,e,c){var a="&comp=block&blockid=",d=f+a+e,b=$.ajax({headers:{"x-ms-meta-uploadvia":"appcompat","x-ms-version":"2015-02-21","Content-Type":"text/plain; charset=UTF-8","x-ms-blob-content-disposition":"attachment; filename='"+c+"'"},type:"PUT",processData:false,url:d,data:g});return b},commitBlob:function(h,g,c,f){for(var e="&comp=blocklist",b="<?xml version='1.0' encoding='utf-8'?><BlockList>",a=0;a<c.length;++a)b+="<Latest>"+c[a]+"</Latest>";b+="</BlockList>";var d=$.ajax({headers:{"x-ms-meta-uploadvia":"appcompat","x-ms-version":"2015-02-21","Content-Type":"text/plain; charset=UTF-8","x-ms-blob-content-disposition":"attachment; filename='"+f+"'"},type:"PUT",url:g+e,data:b});return d},uploadFileToBlobInChunks:function(e,b){var k=524288000,p=2097152,o=1073741824,m=3145728,j=1048576,f=$.Deferred(),g=new FileReader,h=[],d=0,i=b.size,l=0,c=b.size;if(b.size>k)sizeOfBlock=p;else if(b.size>o)sizeOfBlock=m;else sizeOfBlock=j;if(i<sizeOfBlock)sizeOfBlock=i;g.onloadend=function(j){if(j.target.readyState===FileReader.DONE){var i=new Uint8Array(j.target.result),k=a.storage.generateRandomBlockId();h.push(k);a.storage.commitSingleBlock(f,e,i,k,b.name).then(function(){l+=i.length;c-=i.length;if(c>0){d+=sizeOfBlock;if(c<sizeOfBlock)sizeOfBlock=c;g.readAsArrayBuffer(b.slice(d,d+sizeOfBlock))}else a.storage.commitBlob(f,e,h,b.name).then(function(){f.resolve("success");$(t).hide();a.uploadFileAndJsonToEndpoint(e,b,$(y).val(),$(x).val(),$(P).val())})})}};var n=b.slice(0,sizeOfBlock);g.readAsArrayBuffer(n)}},marketplace:{generateRandomBlobName:function(d){function a(){return ((1+Math.random())*65536|0).toString(16).substring(1)}var c=(a()+a()+a()+"-4"+a().substr(0,3)+a()+a()+a()+a()).toLowerCase(),b=d.replace(/\./g,"").replace(/\s/g,"");C=b+c+".ipa";return b+c},getSasUrl:function(d){window.scrollTo(0,0);var b=q+"SASIPA/"+a.marketplace.generateRandomBlobName(d.name);$.ajax({headers:j,type:"GET",url:b,contentType:"application/json",success:function(b){$(".file-drop-wrapper, form").hide();$(t).show();a.storage.uploadFileToBlobInChunks(b,c)},error:function(){a.displaySubmitErrorMessage(n)}})}},submitInputValidation:function(){HipObject.verify(a.hip.verifyHip,d);a.hip.data.solution=HipObject.getSolution();a.hip.data.token=HipObject.getToken();a.hip.data.flowId=HipObject.urlFid;for(var g=JSON.stringify(a.hip.data),e=0;e<arguments.length;e++){if($(arguments[e]).val()===d){a.displayInputErrorMessage(arguments[e],$(arguments[e]).attr("data-required"));return}else $(arguments[e]).val()!==d&&a.removeErrorMessage(arguments[e]);if(e===1){var k=$(arguments[e]).val().toLowerCase();if(!ab.test(k)&&$(arguments[e]).val()!==d){a.displayInputErrorMessage(arguments[e],$(arguments[e]).attr("data-invalid"));return}}}if(!(window.File&&window.FileReader&&window.FileList&&window.Blob)){a.displaySubmitErrorMessage(F);return}if(c===null){a.displaySubmitErrorMessage(T);return}if(c!==null){var f=c.name,h=f.lastIndexOf("."),i=f.substring(h).toLowerCase();if(i!==".ipa"){a.displaySubmitErrorMessage(K);return}if(c.size===0){a.displaySubmitErrorMessage(l);return}}if(HipObject.error===2){a.displaySubmitErrorMessage(U);HipObject.reloadHIP(1);HipObject.setFocus();return}$.ajax({headers:j,type:"POST",url:bb,contentType:false,processData:false,data:g,success:function(){$(".error-container, .report-error").addClass(b);a.marketplace.getSasUrl(c)},error:function(c){if(c.status===412){$(".alert-error").text(O);$(u).removeClass(b);HipObject.reloadHIP(1);HipObject.setFocus()}else a.displaySubmitErrorMessage(n)}})}};function V(){var g=document.location.pathname.split("/")[1].toLowerCase(),e=a.hip.createGuidId(),f=e.split("-").join(""),d="devArcadia",c=Math.floor(a.hip.shuffle()*Number.MAX_VALUE),b="https://client.hip.live.com/GetHIP/GetHipObject/HipObject?mkt="+g+"&fid="+f+"&id="+d+"&type=visual&rnd="+c;$.getScript(b,function(d,a,c){a==="success"&&c.status===200&&$("#ispHIPScript > script").attr("src",b)})}function I(){$(".file-drop").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault();a.stopPropagation()}).on("drop",function(a){c=a.originalEvent.dataTransfer.files[0];$(m).addClass(b);$(v).text(c.name);$(k).removeClass(b)});$(".input-file").on("change",function(a){c=a.target.files[0];$(m).addClass(b);if(c===null||typeof c==="undefined")return;$(v).text(c.name);$(k).removeClass(b)})}function L(){$(".file-info-delete").on("click",function(a){a.preventDefault();c=null;$("input[type='file']").val(null);$(m).removeClass(b);$(k).addClass(b)})}function J(){$("form button[type='submit']").on("click",function(b){b.preventDefault();a.submitInputValidation(y,x)})}function G(){$(".download-dataset").on("click",function(b){b.preventDefault();if(o!==d){var a=window.open(d,"_blank");a.document.write(JSON.stringify(o))}})}Wdc.Cpub.Analyzer.init=function(){V();I();L();J();G();B&&$("body").addClass("rtl")}})();$(function(){Wdc.Cpub.Analyzer.init()})