if(typeof WPCPub==="undefined")WPCPub={};(WPCPub.StoreTrends=function(){"use strict";var storeJSONData=undefined,cultureJSONData=undefined,seriesChartObject=undefined,selectedRegion=undefined,chartHeight=undefined,trendData=undefined,storeTrendsCurrentMonth=undefined,chartIndex=0,pcString="PC",phoneString="Phone",requireString="require",objectString="object",emptyString="",optionSelectedString="option:selected",$storeTrendsLabel=$(".storeTrendsLabel"),storeTrendsLabelString="{0} ({1})",storeRTLLocalesArray=["ar-sa","he-il"],currentLocale=window.location.pathname.split("/")[1].toLocaleLowerCase(),kendoDependencyFilesArray=["k/kendo.core.min","k/kendo.data.min","k/kendo.userevents.min","k/kendo.color.min","k/kendo.dataviz.core.min","k/kendo.dataviz.themes.min","k/kendo.dataviz.chart.min","culture-strings","storetrends-json"],$selectRegion=$("#selectRegion"),kchartString=".k-chart",$radioElements=$(".radio label[data-target^=#pivot]"),selectOptionString="<option value={0}>{1}</option>";String.prototype.format=function(){var s=this,i=arguments.length;while(i--)s=s.replace(new RegExp("\\{"+i+"\\}","gm"),arguments[i]);return s};var worldString="World",clickString="click",trendTypeOsInstallBaseString="OsInstallBase",trendTypeMemoryString="Memory",trendTypeResolutionString="Resolution",trendTypeStorageString="Storage",trendTypeDirectXSupportString="DirectXSupport",trendTypeScreenSizeString="Screen Size",trendTypeDownloadCategoryString="App downloads by category",trendTypeAppSalesCategoryString="App and IAP sales by category",trendTypeAppIAPDownloadsOSString="App and IAP downloads by OS version",trendTypeAppIAPRevenueString="Revenue mix of apps and IAPs",chartElementsObject={};chartElementsObject[trendTypeOsInstallBaseString]="#chart_OsInstallBase_";chartElementsObject[trendTypeMemoryString]="#chart_Memory_";chartElementsObject[trendTypeStorageString]="#chart_Storage_";chartElementsObject[trendTypeResolutionString]="#chart_Resolution_";chartElementsObject[trendTypeDirectXSupportString]="#chart_DirectXSupport_";chartElementsObject[trendTypeScreenSizeString]="#chart_ScreenSize_";chartElementsObject[trendTypeDownloadCategoryString]="#chart_AppDownloadsCategory_";chartElementsObject[trendTypeAppSalesCategoryString]="#chart_AppSalesCategory_";chartElementsObject[trendTypeAppIAPDownloadsOSString]="#chart_AppIAPDownloadsOS_";chartElementsObject[trendTypeAppIAPRevenueString]="#chart_AppIAPRevenue_";var chartLongHeight=450,chartShortHeight=280,trueString=true,falseString=false,monthString="month",autoString="auto",percentileFormatString="{0}%",tooltipTemplateString="#= series.name # (#= kendo.format('{0:n0}',value) #%)",seriesColorsArray=["#303D91","#7160EB","#DA3B01","#881798","#007686","#750B1C","#673693","#498205","#E1048B","#0078D7","#EA6363"],colorffffffString="#ffffff",positionBottomString="bottom",alignLeftString="left",seriesTypeString="column",chartLegendObject={position:positionBottomString,align:alignLeftString},chartSeriesDefaultObject={type:seriesTypeString,stack:trueString,overlay:{gradient:null}},chartValueAxisObject={labels:{format:percentileFormatString},max:100,majorUnit:20,line:{visible:falseString},axisCrossingValue:0},chartCategoryAxisObject={field:monthString,majorGridLines:{visible:falseString},line:{visible:falseString},labels:{rotation:{angle:autoString}}},chartRTLCategoryAxisObject={field:monthString,majorGridLines:{visible:falseString},line:{visible:falseString},labels:{rotation:{angle:autoString}},reverse:true},chartTooltipObject={visible:trueString,format:percentileFormatString,template:tooltipTemplateString,background:colorffffffString,padding:5},chartFieldsArray={OsInstallBase:{PC:[{field:"WindowsSPSEVEN",name:"Windows 7"},{field:"WindowsSPEIGHT",name:"Windows 8"},{field:"WindowsSPEIGHTDOTONE",name:"Windows 8.1"},{field:"WindowsSPONEZERO",name:"Windows 10"}],Phone:[{field:"WindowsSPPhoneSPEIGHT",name:"Windows Phone 8"},{field:"WindowsSPPhoneSPEIGHTDOTONE",name:"Windows Phone 8.1"}]},Memory:{PC:[{field:"LTEQTWOSPGB",name:"<=2 GB"},{field:"THREESPGB",name:"3 GB"},{field:"FOURSPGB",name:"4 GB"},{field:"EIGHTSPGB",name:"8 GB"},{field:"ONESIXSPGB",name:"16 GB"},{field:"GTONESIXSPGB",name:">16 GB"}],Phone:[{field:"EQLTSPTWOFIVESIXk",name:"=< 256k"},{field:"TWOFIVESEVENkDASHNINENINENINEk",name:"257k-999k"},{field:"ONEGBDASHONEDOTNINEGB",name:"1GB-1.9GB"},{field:"GTEQTWOGB",name:">=2GB"}]},Storage:{PC:[{field:"LTEQSIXFOURSPGB",name:"<=64 GB"},{field:"ONETWOEIGHTSPGB",name:"128 GB"},{field:"TWOFIVEZEROSPGB",name:"250 GB"},{field:"FIVEZEROZEROSPGB",name:"500 GB"},{field:"ONESPTB",name:"1 TB"},{field:"TWOSPTB",name:"2 TB"},{field:"GTTWOSPTB",name:">2 TB"}],Phone:[{field:"FOUR",name:"=<4 GB"},{field:"EIGHT",name:"8 GB"},{field:"ONESIX",name:"16 GB"},{field:"THREETWO",name:"32 GB"}]},Resolution:{PC:[{field:"LTSEVENTWOZEROp",name:"<720p"},{field:"SEVENTWOZEROp",name:"720p"},{field:"ONEZEROEIGHTZEROp",name:"1080p"},{field:"ONEFOURFOURZEROp",name:"1440p"},{field:"gteqFOURk",name:">=4k"}]},DirectXSupport:{PC:[{field:"NINE_THREESPorSPlower",name:"<=9_3"},{field:"ONEZERO",name:"10"},{field:"ONEONEPLUS",name:"11+"}]}};chartFieldsArray[trendTypeScreenSizeString]={Phone:[{field:"EQLTSPFOURDOTZERO",name:"=< 4.0"},{field:"FOURDOTONESPtoSPFOURDOTNINE",name:"4.1-4.9"},{field:"FIVEDOTZEROSPtoSPFIVEDOTNINE",name:"5.0-5.9"},{field:"GTEQSPSIXDOTZERO",name:">= 6.0"}]};chartFieldsArray[trendTypeAppIAPDownloadsOSString]={PC:[{field:"WindowsSPEIGHT",name:"Windows 8"},{field:"WindowsSPEIGHTDOTONE",name:"Windows 8.1"},{field:"WindowsSPONEZERO",name:"Windows 10"}],Phone:[{field:"WindowsSPPhoneSPEIGHT",name:"Windows Phone 8"},{field:"WindowsSPPhoneSPEIGHTDOTONE",name:"Windows Phone 8.1"}]};var processCultureData=function(){cultureJSONData=window.localizedStrings;chartFieldsArray[trendTypeDownloadCategoryString]=[{field:"BooksSPANDSPReference",name:cultureJSONData[currentLocale]["Books & Reference"]},{field:"Business",name:cultureJSONData[currentLocale].Business},{field:"Education",name:cultureJSONData[currentLocale].Education},{field:"Entertainment",name:cultureJSONData[currentLocale].Entertainment},{field:"Games",name:cultureJSONData[currentLocale].Games},{field:"HealthSPANDSPFitness",name:cultureJSONData[currentLocale]["Health & Fitness"]},{field:"Lifestyle",name:cultureJSONData[currentLocale].Lifestyle},{field:"Music",name:cultureJSONData[currentLocale].Music},{field:"NewsSPANDSPWeather",name:cultureJSONData[currentLocale]["News & Weather"]},{field:"PhotoSPANDSPvideo",name:cultureJSONData[currentLocale]["Photo & video"]},{field:"Productivity",name:cultureJSONData[currentLocale].Productivity},{field:"Shopping",name:cultureJSONData[currentLocale].Shopping},{field:"Social",name:cultureJSONData[currentLocale].Social},{field:"Sports",name:cultureJSONData[currentLocale].Sports},{field:"Travel",name:cultureJSONData[currentLocale].Travel},{field:"UtilitiesSPANDSPtools",name:cultureJSONData[currentLocale]["Utilities & tools"]},{field:"NavigationSPANDSPMaps",name:cultureJSONData[currentLocale]["Navigation & Maps"]},{field:"Other",name:cultureJSONData[currentLocale].Other}];chartFieldsArray[trendTypeAppIAPRevenueString]=[{field:"PaidSPApps",name:cultureJSONData[currentLocale]["Paid Apps"]},{field:"IAP",name:cultureJSONData[currentLocale].IAP}]},processGraphData=function(){storeJSONData=window.graphData;var regionString=undefined;for(var trendName in storeJSONData)if(trendName!==emptyString&&trendName!==undefined&&typeof storeJSONData[trendName]===objectString){for(var region in storeJSONData[trendName])if(region!==emptyString&&region!==undefined){regionString=cultureJSONData[currentLocale][region]?cultureJSONData[currentLocale][region]:region;$selectRegion.append(selectOptionString.format(JSON.stringify(region),regionString))}break}$selectRegion.change(function(){selectedRegion=this.value;chartIndex=0;setCreateChartTimer([trendTypeOsInstallBaseString,trendTypeMemoryString,trendTypeStorageString,trendTypeResolutionString,trendTypeDirectXSupportString,trendTypeScreenSizeString,trendTypeDownloadCategoryString,trendTypeAppSalesCategoryString,trendTypeAppIAPDownloadsOSString,trendTypeAppIAPRevenueString]);$storeTrendsLabel.text(storeTrendsLabelString.format(storeTrendsCurrentMonth,$(this).find(optionSelectedString).text()))});$selectRegion.val(worldString).change()},storeKendoFieldsFormatting=function(jsondata){for(var storeKendoData=[],gamerObj=undefined,monthRegeEx=/(\w+)\s(\d{4})/,categoryRegEx=/[ .<=>+&-0123456789]/g,spaceString=" ",replaceCharacters={" ":"SP",".":"DOT","<":"LT","=":"EQ",">":"GT","+":"PLUS","&":"AND","-":"DASH","0":"ZERO","1":"ONE","2":"TWO","3":"THREE","4":"FOUR","5":"FIVE","6":"SIX","7":"SEVEN","8":"EIGHT","9":"NINE"},i=0,jsonlen=jsondata.length;i<jsonlen;i++){for(var month in jsondata[i])if(month!==emptyString&&month!==undefined){gamerObj={};gamerObj[monthString]=month.replace(monthRegeEx,cultureJSONData[currentLocale][month.split(spaceString)[0]]);for(var category in jsondata[i][month])if(category!==emptyString&&category!==undefined)gamerObj[category.replace(categoryRegEx,function(s){return replaceCharacters[s]})]=parseFloat((jsondata[i][month][category]*100).toFixed(2));storeKendoData.push(gamerObj)}if(storeTrendsCurrentMonth===undefined)storeTrendsCurrentMonth=gamerObj[monthString]}return storeKendoData},setCreateChartTimer=function(trends){createKendoGraphChart(trends[chartIndex++]);chartIndex<trends.length&&setTimeout(setCreateChartTimer.bind(window,trends),10)},createKendoGraphChart=function(trendtype){for(var charttype in storeJSONData[trendtype][selectedRegion])if(storeJSONData[trendtype][selectedRegion].hasOwnProperty([charttype])){trendData=storeKendoFieldsFormatting(storeJSONData[trendtype][selectedRegion][charttype]);chartHeight=chartShortHeight;switch(trendtype){case trendTypeDownloadCategoryString:seriesChartObject=chartFieldsArray[trendtype];chartHeight=chartLongHeight;break;case trendTypeAppSalesCategoryString:seriesChartObject=chartFieldsArray[trendTypeDownloadCategoryString];chartHeight=chartLongHeight;break;case trendTypeAppIAPRevenueString:seriesChartObject=chartFieldsArray[trendTypeAppIAPRevenueString];break;case trendTypeOsInstallBaseString:chartHeight=chartLongHeight;default:seriesChartObject=charttype.indexOf(phoneString)>=0?chartFieldsArray[trendtype][phoneString]:chartFieldsArray[trendtype][pcString];break}$(chartElementsObject[trendtype]+charttype).kendoChart({dataSource:{data:trendData},chartArea:{height:chartHeight},legend:chartLegendObject,seriesDefaults:chartSeriesDefaultObject,seriesColors:seriesColorsArray,series:seriesChartObject,valueAxis:chartValueAxisObject,categoryAxis:storeRTLLocalesArray.indexOf(currentLocale)>-1?chartRTLCategoryAxisObject:chartCategoryAxisObject,tooltip:chartTooltipObject})}};define([requireString],function(require){require(kendoDependencyFilesArray,function(){$(document).ready(function(){processCultureData();processGraphData();$radioElements.on(clickString,function(){kendo.resize($(kchartString))})});$(window).resize(function(){kendo.resize($(kchartString))})})})})()